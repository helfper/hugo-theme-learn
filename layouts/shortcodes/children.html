{{ $_hugo_config := `{ "version": 1 }` }}
{{ $showhidden := .Get "showhidden"}}
{{ $style := .Get "style" | default "li" }}
{{ $depth := .Get "depth" | default 1 }}
{{ $description := .Get "description" | default false }}
{{ $sortTerm := .Get "sort" | default "Weight" }}

<ul class="children children-{{$style}}">
	{{template "children" dict "pages" .Page.Pages "style" $style "showhidden" $showhidden "count" 1 "depth" $depth "description" $description "sortTerm" $sortTerm}}
</ul>

{{ define "children" }}
	{{ $pages := .pages }}
	{{if eq $.sortTerm "Weight"}}
		{{ $pages = $pages.ByWeight }}
	{{else if or (eq $.sortTerm "Title") (eq $.sortTerm "Name")}}
		{{ $pages = $pages.ByTitle }}
	{{else if eq $.sortTerm "PublishDate"}}
		{{ $pages = $pages.ByPublishDate }}
	{{else if eq $.sortTerm "Date"}}
		{{ $pages = $pages.ByDate }}
	{{else if eq $.sortTerm "Length"}}
		{{ $pages = $pages.ByLength }}
	{{end}}
	{{ range $pages }}
		{{ if or (not .Params.hidden) $.showhidden }}
			{{if not .IsHome}}
				{{if hasPrefix $.style "h"}}
					{{$num := sub ( int (trim $.style "h") ) 1 }}
					{{$numn := add $num $.count }}

{{(printf "<h%d>" $numn)|safeHTML}}
<a href="{{.RelPermalink}}" >{{ .Title }}</a>
{{(printf "</h%d>" $numn)|safeHTML}}

				{{else}}
{{(printf "<%s>" $.style)|safeHTML}}
<a href="{{.RelPermalink}}" >{{ .Title }}</a>
{{(printf "</%s>" $.style)|safeHTML}}
				{{end}}

				{{if $.description}}
					{{if .Description}}
<p>{{.Description}}</p>
					{{else}}
<p>{{.Summary}}</p>
					{{end}}
				{{end}}
			{{end}}
			{{ if lt $.count $.depth}}

				{{if eq $.style "li"}}
<ul>
				{{end}}

				{{template "children" dict "pages" (.Pages | union .Sections) "style" $.style "showhidden" $.showhidden "count" (add $.count 1) "depth" $.depth "description" $.description "sortTerm" $.sortTerm}}

				{{if eq $.style "li"}}
</ul>
				{{end}}
			{{end}}
		{{end}}
	{{end}}
{{end}}